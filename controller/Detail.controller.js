sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","../model/formatter","../model/mapper"],function(t,e,o,a,n){"use strict";return t.extend("simmel.mappaInterattiva.controller.Detail",{onInit:function(){this.getRouter().getRoute("detail").attachPatternMatched(this._onRouteMatched,this);this._initDetailData()},_initDetailData:function(){const t=new e;const o=async()=>await t.loadData("../data/data.json");const a=async()=>await t.loadData("../data/legend.json");const n=async()=>await t.loadData("../data/regions.json");const i=async()=>await t.loadData("../data/agreement.json");const s=async()=>await t.loadData("../data/contracts.json");const r=async()=>await t.loadData("../data/offers.json");const l=async()=>await t.loadData("../data/bid-nobid.json");const g=async()=>await t.loadData("../data/chart1.json");o().then(()=>{const{data:e}=t.getData();this.getOwnerComponent().getModel("detail").setProperty("/data",e)});a().then(()=>{const{legend:e}=t.getData();this.getOwnerComponent().getModel("detail").setProperty("/legend",e)});n().then(()=>{const{regions:e}=t.getData();this.getOwnerComponent().getModel("detail").setProperty("/regions",e)});i().then(()=>{const{agreements:e}=t.getData();this.getOwnerComponent().getModel("detail").setProperty("/agreements",e)});s().then(()=>{const{contracts:e}=t.getData();this.getOwnerComponent().getModel("detail").setProperty("/contracts",e)});r().then(()=>{const{offers:e}=t.getData();this.getOwnerComponent().getModel("detail").setProperty("/offers",e)});l().then(()=>{const{bidnobid:e}=t.getData();this.getOwnerComponent().getModel("detail").setProperty("/bidnobid",e)});g().then(()=>{const{milk:e}=t.getData();this.getOwnerComponent().getModel("detail").setProperty("/panel/chart1/data",e)})},_onRouteMatched:function(t){if(t.getParameter("arguments").country){this.byId("vbi1").fireRegionClick({code:t.getParameter("arguments").country})}},onRegionClick:function(t){const e=t.getParameter("code");if(!t.getSource().getRegionMap()[e]){this.getModel("detail").setProperty("/selectedRegion",null);this.byId("detailsPanel").setExpanded(false);t.getSource().setCenterPosition("5;35;0");t.getSource().setZoomlevel(2);return this.getRouter().navTo("master")}const o=t.getSource().getRegionMap()[e].getBindingContext("detail");this.getModel("detail").setProperty("/selectedRegion",o.getObject());this.byId("detailsPanel").setExpanded(true);Object.values(t.getSource().getRegionMap()).forEach(t=>{if(t.getCode()===e)t.setSelect(true);else t.setSelect(false)});t.getSource().zoomToRegions([e])},onSpotClick:function(t){const a=t.getSource();const i=a.getBindingContext("detail");t.getSource().getParent().getParent().fireRegionClick({code:i.getProperty("country")});if(!this._oAgreementDetailsDialog){this._oAgreementDetailsDialog=o.load({id:this.getView().getId(),name:"simmel.mappaInterattiva.view.fragment.detail.DetailsDialog",type:"XML",controller:this}).then(t=>{this.getView().addDependent(t);t.setModel(new e({agreement:{},contracts:{},offers:{panel:{selectedOffer:null},treeTable:{rows:{}}},bidnobid:{}}),"detailsDialog");return t})}this._oAgreementDetailsDialog.then(t=>{const e=this.getModel("detail").getProperty("/agreements").filter(t=>t.country===i.getProperty("country"));const o=this.getModel("detail").getProperty("/contracts").filter(t=>t.country===i.getProperty("country"));const a=this.getModel("detail").getProperty("/offers").filter(t=>t.country===i.getProperty("country"));const s=this.getModel("detail").getProperty("/bidnobid").filter(t=>t.country===i.getProperty("country"));t.getContent()[0].getItems()[0].setSelectedKey("agreement");t.getModel("detailsDialog").setProperty("/context",i.getObject());t.getModel("detailsDialog").setProperty("/agreement/items",e);t.getModel("detailsDialog").setProperty("/contracts/items",o);t.getModel("detailsDialog").setProperty("/offers/treeTable/rows",n.mapTreeTableData(a));t.getModel("detailsDialog").setProperty("/bidnobid/items",s);t.open()})},_getContactsDetailsDialog:function(t){if(!this._oContactsDetailsDialog){this._oContactsDetailsDialog=o.load({id:this.getView().getId(),name:"simmel.mappaInterattiva.view.fragment.dialog.subfragment.ContactsDetailsDialog",type:"XML",controller:this}).then(t=>{this.getView().addDependent(t);t.setModel(new e({}),"contactsDialog");return t})}this._oContactsDetailsDialog.then(e=>{e.getModel("contactsDialog").setData(t.getProperty("contacts"));e.open()})},onContactsButtonPress:function(t){const e=t.getSource().getBindingContext("detailsDialog");this._getContactsDetailsDialog(e)},onGanttChartShapePress:function(t){const e=t.getParameter("shape");const o=e.getBindingContext("detailsDialog");const a=e.getBindingContext("detailsDialog").getModel();a.setProperty("/offers/panel/selectedOffer",o.getObject())}})});