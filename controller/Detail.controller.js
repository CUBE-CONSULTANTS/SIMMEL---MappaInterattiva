sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","../model/formatter","../model/mapper"],function(e,t,o,a,n){"use strict";return e.extend("simmel.mappaInterattiva.controller.Detail",{onInit:function(){this.getRouter().getRoute("detail").attachPatternMatched(this._onRouteMatched,this);this._initDetailData()},_initDetailData:function(){const e=new t;const o=async()=>await e.loadData("./data/data.json");const a=async()=>await e.loadData("./data/legend.json");const n=async()=>await e.loadData("./data/regions.json");const i=async()=>await e.loadData("./data/agreement.json");const s=async()=>await e.loadData("./data/contracts.json");const r=async()=>await e.loadData("./data/offers.json");const l=async()=>await e.loadData("./data/bid-nobid.json");const g=async()=>await e.loadData("./data/chart1.json");o().then(()=>{const{data:t}=e.getData();this.getOwnerComponent().getModel("detail").setProperty("/data",t)});a().then(()=>{const{legend:t}=e.getData();this.getOwnerComponent().getModel("detail").setProperty("/legend",t)});n().then(()=>{const{regions:t}=e.getData();this.getOwnerComponent().getModel("detail").setProperty("/regions",t)});i().then(()=>{const{agreements:t}=e.getData();this.getOwnerComponent().getModel("detail").setProperty("/agreements",t)});s().then(()=>{const{contracts:t}=e.getData();this.getOwnerComponent().getModel("detail").setProperty("/contracts",t)});r().then(()=>{const{offers:t}=e.getData();this.getOwnerComponent().getModel("detail").setProperty("/offers",t)});l().then(()=>{const{bidnobid:t}=e.getData();this.getOwnerComponent().getModel("detail").setProperty("/bidnobid",t)});g().then(()=>{const{milk:t}=e.getData();this.getOwnerComponent().getModel("detail").setProperty("/panel/chart1/data",t)})},_onRouteMatched:function(e){if(e.getParameter("arguments").country){this.byId("vbi1").fireRegionClick({code:e.getParameter("arguments").country})}},onRegionClick:function(e){const t=e.getParameter("code");if(!e.getSource().getRegionMap()[t]){this.getModel("detail").setProperty("/selectedRegion",null);this.byId("detailsPanel").setExpanded(false);e.getSource().setCenterPosition("5;35;0");e.getSource().setZoomlevel(2);return this.getRouter().navTo("master")}const o=e.getSource().getRegionMap()[t].getBindingContext("detail");this.getModel("detail").setProperty("/selectedRegion",o.getObject());this.byId("detailsPanel").setExpanded(true);Object.values(e.getSource().getRegionMap()).forEach(e=>{if(e.getCode()===t)e.setSelect(true);else e.setSelect(false)});e.getSource().zoomToRegions([t])},onSpotClick:function(e){const a=e.getSource();const i=a.getBindingContext("detail");e.getSource().getParent().getParent().fireRegionClick({code:i.getProperty("country")});if(!this._oAgreementDetailsDialog){this._oAgreementDetailsDialog=o.load({id:this.getView().getId(),name:"simmel.mappaInterattiva.view.fragment.detail.DetailsDialog",type:"XML",controller:this}).then(e=>{this.getView().addDependent(e);e.setModel(new t({agreement:{},contracts:{},offers:{panel:{selectedOffer:null},treeTable:{rows:{}}},bidnobid:{}}),"detailsDialog");return e})}this._oAgreementDetailsDialog.then(e=>{const t=this.getModel("detail").getProperty("/agreements").filter(e=>e.country===i.getProperty("country"));const o=this.getModel("detail").getProperty("/contracts").filter(e=>e.country===i.getProperty("country"));const a=this.getModel("detail").getProperty("/offers").filter(e=>e.country===i.getProperty("country"));const s=this.getModel("detail").getProperty("/bidnobid").filter(e=>e.country===i.getProperty("country"));e.getContent()[0].getItems()[0].setSelectedKey("agreement");e.getModel("detailsDialog").setProperty("/context",i.getObject());e.getModel("detailsDialog").setProperty("/agreement/items",t);e.getModel("detailsDialog").setProperty("/contracts/items",o);e.getModel("detailsDialog").setProperty("/offers/treeTable/rows",n.mapTreeTableData(a));e.getModel("detailsDialog").setProperty("/bidnobid/items",s);e.open()})},onGoToDetailsPress:function(e){const a=this.getModel("detail").getProperty("/selectedRegion");const{country_code:i}=a;if(!this._oAgreementDetailsDialog){this._oAgreementDetailsDialog=o.load({id:this.getView().getId(),name:"simmel.mappaInterattiva.view.fragment.detail.DetailsDialog",type:"XML",controller:this}).then(e=>{this.getView().addDependent(e);e.setModel(new t({agreement:{},contracts:{},offers:{panel:{selectedOffer:null},treeTable:{rows:{}}},bidnobid:{}}),"detailsDialog");return e})}this._oAgreementDetailsDialog.then(e=>{const t=this.getModel("detail").getProperty("/agreements").filter(e=>e.country===i);const o=this.getModel("detail").getProperty("/contracts").filter(e=>e.country===i);const s=this.getModel("detail").getProperty("/offers").filter(e=>e.country===i);const r=this.getModel("detail").getProperty("/bidnobid").filter(e=>e.country===i);e.getContent()[0].getItems()[0].setSelectedKey("agreement");e.getModel("detailsDialog").setProperty("/context",a);e.getModel("detailsDialog").setProperty("/agreement/items",t);e.getModel("detailsDialog").setProperty("/contracts/items",o);e.getModel("detailsDialog").setProperty("/offers/treeTable/rows",n.mapTreeTableData(s));e.getModel("detailsDialog").setProperty("/bidnobid/items",r);e.open()})},_getContactsDetailsDialog:function(e){if(!this._oContactsDetailsDialog){this._oContactsDetailsDialog=o.load({id:this.getView().getId(),name:"simmel.mappaInterattiva.view.fragment.dialog.subfragment.ContactsDetailsDialog",type:"XML",controller:this}).then(e=>{this.getView().addDependent(e);e.setModel(new t({}),"contactsDialog");return e})}this._oContactsDetailsDialog.then(t=>{t.getModel("contactsDialog").setData(e.getProperty("contacts"));t.open()})},onContactsButtonPress:function(e){const t=e.getSource().getBindingContext("detailsDialog");this._getContactsDetailsDialog(t)},onGanttChartShapePress:function(e){const t=e.getParameter("shape");const o=t.getBindingContext("detailsDialog");const a=t.getBindingContext("detailsDialog").getModel();a.setProperty("/offers/panel/selectedOffer",o.getObject())}})});